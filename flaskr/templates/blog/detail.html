{% extends "base.html" %}

{% block content %}
	<article class="post">
		<header>
			<div>
				<h1> {{ post["title"] }} </h1>
				<div class="about">by {{ post["username"] }} on {{ post["created"].strftime("%Y-%m-%d") }}</div>
			</div>
			{% if g.user["id"] == post["author_id"] %}
				<a class="action" href="{{ url_for('blog.update', id=post['id']) }}">Edit</a>
			{% endif %}
		</header>
		<p class="body">{{ post["body"] }}</p>

		<button id="comment_button{{post['id']}}" onclick="expandTextarea('comment', {{post['id']}})">comment</button>
		<form id="comment_form{{post['id']}}" method="post" style="display: none">
			<textarea name="inputbody" id="input_body" placeholder="write something thoughtful"></textarea>
			<input type="submit" id="save_comment{{post['id']}}" value="Save comment">
		</form>
	</article>

<script>
	$("#comment_form").on("submit", function(event) {
		console.log("this works")
		$.ajax({
			data : {
				body: $("#input_body").val()
			},
			type: "POST",
			url: "/" + {{ post["id"] }} + "/detail", 
			success: function(data) {
		      $(".comments").replaceWith(data.body)
		    }
		})

		event.preventDefault(); 
	})
</script>

	<div class="comments"> 
		<h4> Comments </h4>
		{% for comment in comments %}
			<article class="post">
				<div class="about"> by {{ comment["username"] }} on {{ comment["created"].strftime("%Y-%m-%d") }}
				</div>
				<p class="body">{{ comment["body"] }}</p>
			<button id="comment_button{{comment['id']}}" onclick="expandTextarea('comment', {{comment['id']}})">reply</button>
			<form id="comment_form{{comment['id']}}" method="post" style="display: none">
				<textarea name="inputbody" id="input_body" placeholder="write something thoughtful"></textarea>
				<input type="submit" id="save_comment{{comment['id']}}" value="Save comment">
			</form>
			</article>
			{% if not loop.last %}
				<hr>
			{% endif %}
		{% endfor %}
	</div>
{% endblock %}